<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Kaskada Docs</title>
    <link rel="canonical" href="https://kaskada-ai.github.io/docs-site/kaskada/main/fenl/fenl-quick-start.html">
    <link rel="prev" href="../reference/working-with-slices.html">
    <link rel="next" href="language-guide.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
    <nav class="navbar">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://kaskada-ai.github.io/docs-site">Kaskada Docs</a>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>
</header><div class="body">
<div class="nav-container" data-component="kaskada" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Kaskada Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting-started/hello-world.html">Hello World</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/hello-client-setup.html">Client Setup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/hello-loading-data.html">Loading Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/hello-querying-data.html">Querying Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/hello-sharing-queries.html">Sharing Queries</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">How-To Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../how-to-guides/exporting-for-training.html">Exporting Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../how-to-guides/integrating-with-feature-stores.html">Serving Features</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/client-authentication.html">Client Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/client-credentials.html">Client Credentials</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/client-installation.html">Client Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/expected-file-format.html">Expected File Format</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/tables.html">Working with Tables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/views.html">Working with Views</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/writing-queries.html">Writing Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/example-queries.html">Examples Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/working-with-materializations.html">Working with Materializations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/working-with-slices.html">Working with Slices</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Fenl</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="fenl-quick-start.html">Fenl Quick Start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="language-guide.html">Fenl Language Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="data-model.html">Data model</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="syntax.html">Syntax</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entities.html">Entities</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="temporal-aggregation.html">Temporal Computation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="aggregation-and-windowing.html">Aggregation and Windowing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="continuity.html">Continuity</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="catalog.html">Fenl Catalog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fenl-faq.html">Fenl FAQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="working-with-records.html">Working with Records</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Kaskada Documentation</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Kaskada Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Kaskada Documentation</a></li>
    <li>Fenl</li>
    <li><a href="fenl-quick-start.html">Fenl Quick Start</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="paragraph">
<p>Let&#8217;s walk through an example of using Fenl to build features for a
simple fraud detection model.</p>
</div>
<div class="sect1">
<h2 id="data-model"><a class="anchor" href="#data-model"></a><a class="link" href="#data-model">Data Model</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Features will be built from two event tables; a <code>Purchase</code> table and a
<code>FraudReport</code> table. The goal will be to build a model predicting if a
given purchase will result in a fraud report within the next 30 days.</p>
</div>
<div class="paragraph">
<p>A <code>Purchase</code> event occurs when a transaction is recorded. It describes
the items that were purchased, the vendor selling the items, the
customer buying the items and the total value of the transaction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"># Purchases
{ time: timestamp_ns, id: string, vendor_id: string, customer_id: string, total: i64 }</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity(id)</th>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">vendor_id</th>
<th class="tableblock halign-left valign-top">customer_id</th>
<th class="tableblock halign-left valign-top">total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A <code>FraudReport</code> event occurs when a transaction is reported as
fraudulent. It identifies the purchase that was reported as fraudulent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json"># FraudReports
{ time: timestamp_ns, purchase_id: string }</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity (purchase_id)</th>
<th class="tableblock halign-left valign-top">time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The values produced by a Fenl expression are associated with an <em>entity
key</em>. Entity keys describe something each value is associated with. For
example, a purchase could be related to a specific user, and a fraud
report could be related to a specific vendor. The <code>Purchase</code> table&#8217;s
entity key is the <code>id</code> field, while the <code>FraudReport</code> table&#8217;s entity key
is the <code>purchase_id</code> field. Any entity key will do - these specific keys
are chosen because they&#8217;re convenient for this exercise.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simple-aggregation-target-value"><a class="anchor" href="#simple-aggregation-target-value"></a><a class="link" href="#simple-aggregation-target-value">Simple Aggregation: Target Value</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we can start building the inputs to our model, we need to
describe the target value the model will predict. We would like to
predict if a given purchase will result in a fraud report - if the
number of daily fraud reports is greater than zero.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">let Target = count(FraudReport, window=since(daily())) &gt; 0</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity</th>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">entity</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>true</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Aggregations in Fenl are scoped to entity key; the <code>Target</code> expression
produces a <code>bool</code> value associated with <em>each</em> purchase (as identified
by <code>FraudReport.purchase_id</code>). In this case we&#8217;ve applied a window
operation to the aggregation - the target value is the number of
<code>FraudReport</code> values so far in a given day.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="first-feature-purchase-total"><a class="anchor" href="#first-feature-purchase-total"></a><a class="link" href="#first-feature-purchase-total">First Feature: Purchase Total</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can describe some simple features based on attributes of a purchase
event. For example, we can describe the purchase total by referencing
the appropriate event field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">let PurchaseTotal = Purchase.total</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity</th>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">Purchase.total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5000</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>12</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Fenl expressions are either <em>continuous</em> or <em>discrete</em>. Discrete
expressions are defined at a finite set of times and their value is
<code>null</code> at all other times. For example, <code>PurchaseTotal</code> is a discrete
expression: it is defined at the times associated with each purchase
event.</p>
</div>
<div class="paragraph">
<p>Continuous expressions are defined at <em>all</em> times, and are generally the
result of an aggregation. For example, <code>Target</code> is a continuous
expression because it uses the <code>count()</code> aggregation: at any point in
time its value is <code>true</code> if there have been 1 or more <code>FraudReport</code>
events before that time or <code>false</code> otherwise.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changing-entity-key-purchase-average-by-customer-part-i"><a class="anchor" href="#changing-entity-key-purchase-average-by-customer-part-i"></a><a class="link" href="#changing-entity-key-purchase-average-by-customer-part-i">Changing Entity Key: Purchase Average by Customer part I</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>It could be useful to compare how each individual purchase compares to
the customer&#8217;s other purchases. We can describe a given customer&#8217;s
purchases by transforming the purchase table to use <code>customer_id</code> as the
entity key rather than <code>id</code>. The resulting expression contains the same
values, but aggregations will now be scoped to customer ID rather than a
purchase ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">let PurchaseByCustomer = Purchase | with_key($input.customer_id)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity</th>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">vendor_id</th>
<th class="tableblock halign-left valign-top">customer_id</th>
<th class="tableblock halign-left valign-top">total</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>karen</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>karen</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>karen</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>karen</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>karen</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>patrick</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>patrick</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>patrick</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>patrick</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>patrick</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This expression uses "pipe syntax" which allows sequential
operations to be chained.</p>
</div>
<div class="paragraph">
<p>Pipe syntax works by assigning the left-hand-side of the pipe to the
name <code>$input</code> in the right-hand-side of the pipe. Within the
right-hand-side of a pipe expression, required function arguments that
are omitted from the function call default to <code>$input</code>.</p>
</div>
<div class="paragraph">
<p>An equivalent way to write this expression is
<code>let PurchaseByCustomer = with_key(Purchase.customer_id, Purchase)</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This allows us to describe the average of each customer&#8217;s purchases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">let AveragePurchaseByCustomer = PurchaseByCustomer.total | mean()</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">entity</th>
<th class="tableblock halign-left valign-top">&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mean()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5.5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4.5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4.6</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6.666</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1255</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Expressions in Fenl are <em>temporal</em>; they describe the result of a given
computation at every point in time. In this case,
<code>AveragePurchaseByCustomer</code> is an expression whose value changes over
time as purchase events occur. The temporal nature of expressions allows
Fenl to describe the values as they would have been computed at
arbitrary times in the past.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="joining-between-entities-purchase-average-by-customer-part-ii"><a class="anchor" href="#joining-between-entities-purchase-average-by-customer-part-ii"></a><a class="link" href="#joining-between-entities-purchase-average-by-customer-part-ii">Joining Between Entities: Purchase Average By Customer part II</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Our goal is to predict if a given <em>purchase</em> will be reported as
fraudulent, but the entity key of <code>AveragePurchaseByCustomer</code> describes
a <em>customer</em>. We can operate between entities by "looking up" the
average purchase of a particular purchase&#8217;s customer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">let CustomerAveragePurchase = AveragePurchaseByCustomer | lookup(Purchase.customer_id)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity</th>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">customer_id</th>
<th class="tableblock halign-left valign-top">&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lookup(&#8230;&#8203;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5.5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1255</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4.5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4.6</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6.666</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this case, for each <code>Purchase</code> event, the value of
<code>AveragePurchaseByCustomer</code> computed for the purchases <code>customer_id</code> <em>at
the time of the purchase</em> is produced. The value being looked up (in
this case <code>AveragePurchaseByCustomer</code>) is referred to as the <em>foreign</em>
value, while the value describing the foreign entity (in this case
<code>Purchase.customer_id</code>) is referred to as the <em>key</em> value.</p>
</div>
<div class="paragraph">
<p>Lookups are similar to SQL left-joins: a foreign value is produced for
each key value. In contrast to SQL joins, the lookup produces the
foreign expression value at the point in time associated with each key
expression value.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="time-travel-shifting-features-forward-in-time"><a class="anchor" href="#time-travel-shifting-features-forward-in-time"></a><a class="link" href="#time-travel-shifting-features-forward-in-time">Time Travel: Shifting Features Forward in Time</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>We would like to predict if a purchase will result in a fraud report
within 30 days of the purchase. We began by describing our <code>Target</code>
value, and then we described two features that could be useful for
making such a prediction: <code>PurchaseTotal</code> and <code>CustomerAveragePurchase</code>.</p>
</div>
<div class="paragraph">
<p>For our model to make predictions about the future, it must be trained
on features and target values computed at different points in time - we
would like the target value to be computed 30 days after the feature
values.</p>
</div>
<div class="paragraph">
<p>Fenl allows values to "time-travel" forward in time. This can be
accomplished by <em>shifting</em> the feature expressions forward in time by 30
days:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">let ShiftedPurchaseTime            = PurchaseTotal.time | add_time(days(30))
let ShiftedCustomerAverageTime     = CustomerAveragePurchase.time | add_time(days(30))
let ShiftedPurchaseTotal           = PurchaseTotal | shift_to(ShiftedPurchaseTime)
let ShiftedCustomerAveragePurchase = CustomerAveragePurchase | shift_to(ShiftedCustomerAverageTime)</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity</th>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">ShiftedPurchaseTotal</th>
<th class="tableblock halign-left valign-top">ShiftedCustomerAveragePurchase</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>130</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>131</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>132</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>133</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1255</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>133</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>134</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>130</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>131</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>132</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.666</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>134</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1005.8</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The result of these shift operations contain the same values as
<code>PurchaseTotal</code> and <code>CustomerAveragePurchase</code>, but the times associated
with each value will be 30 days later. We can now describe our training
set by combining the shifted predictor values with the non-shifted
target value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">let TrainingExample = {
  p_total: ShiftedPurchaseTotal,
  avg_purchase: ShiftedCustomerAveragePurchase,
  target: Target,
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity</th>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">p_total</th>
<th class="tableblock halign-left valign-top">avg_purchase</th>
<th class="tableblock halign-left valign-top">target</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">130</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">131</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">133</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">133</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">134</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">130</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">131</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.666</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">134</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1005.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Values cannot travel <em>backwards</em> in time. This helps to ensure
that temporal leakage cannot happen.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="going-to-production-feature-vectors"><a class="anchor" href="#going-to-production-feature-vectors"></a><a class="link" href="#going-to-production-feature-vectors">Going to Production: Feature Vectors</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once a model has been trained, we&#8217;ll need to compute feature vectors for
making predictions. Feature vectors consist of the non-shifted predictor
expressions but not the target value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">let FeatureVector = {
  p_total: PurchaseTotal,
  avg_purchase: CustomerAveragePurchase,
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">entity</th>
<th class="tableblock halign-left valign-top">time</th>
<th class="tableblock halign-left valign-top">p_total</th>
<th class="tableblock halign-left valign-top">avg_purchase</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1255</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.666</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1005.8</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>PurchaseTotal</code> is a discrete expression whose value depends on
the purchase event. A feature store implementation would seem to require
some way of providing the "current" event. Alternately, we may want to
omit discrete values and tell users they have to provide this type of
information to the model.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../reference/working-with-slices.html">Working with Slices</a></span>
  <span class="next"><a href="language-guide.html">Fenl Language Guide</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
&copy; Copyright The Kaskada Authors 
</footer><script src="../../../_/js/site.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script src="../../../_/js/vendor/fenl.min.js"></script>
<script>hljs.highlightAll();</script>
  </body>
</html>
