<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Aggregation and Windowing :: Kaskada Docs</title>
    <link rel="canonical" href="https://kaskada-ai.github.io/docs-site/kaskada/main/fenl/aggregation-and-windowing.html">
    <link rel="prev" href="temporal-aggregation.html">
    <link rel="next" href="continuity.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
    <nav class="navbar">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://kaskada-ai.github.io/docs-site">Kaskada Docs</a>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>
</header><div class="body">
<div class="nav-container" data-component="kaskada" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../getting-started/installation.html">Kaskada Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/loading-data.html">Loading Data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/querying-data.html">Querying Data</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../installing.html">Installing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../loading-data.html">Loading Data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/tables.html">Tables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/example-queries.html">Example Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/slices.html">Slices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/views.html">Views</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/materializations.html">Working with Materializations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrating</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrating/integrating-with-feature-stores.html">Integrating with ML feature stores</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tools and Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools-and-resources/training-realtime-ml-models.html">Training real-time ML models</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools-and-resources/exporting-for-training.html">Example Modeling Problem</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Fenl</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fenl-quick-start.html">Fenl Quick Start</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="language-guide.html">Fenl Language Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="data-model.html">Data model</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="syntax.html">Syntax</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="entities.html">Entities</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="temporal-aggregation.html">Temporal Computation</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="aggregation-and-windowing.html">Aggregation and Windowing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="continuity.html">Continuity</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="catalog.html">Fenl Catalog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fenl-faq.html">Fenl FAQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="working-with-records.html">Working with Records</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Kaskada Documentation</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../getting-started/installation.html">Kaskada Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../getting-started/installation.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../getting-started/installation.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../getting-started/installation.html">Kaskada Documentation</a></li>
    <li>Fenl</li>
    <li><a href="language-guide.html">Fenl Language Guide</a></li>
    <li><a href="aggregation-and-windowing.html">Aggregation and Windowing</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Aggregation and Windowing</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Temporal computation is most important when dealing with aggregations,
because aggregations incorporate values associated with <em>different</em>
times.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basic-aggregations"><a class="anchor" href="#basic-aggregations"></a><a class="link" href="#basic-aggregations">Basic Aggregations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can think of aggregations as consuming a stream of input values and
producing a stream of output values. By default each time an aggregation
consumes an input it produces an output. In this case the time
associated with each output is the same as the time associated with the
corresponding input, and the output&#8217;s value is the result of applying
the aggregation to all the inputs consumed up to that time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">Purchase.amount | sum()</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Time</th>
<th class="tableblock halign-left valign-top">Purchase.amount</th>
<th class="tableblock halign-left valign-top">&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sum()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012-02-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012-05-10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-11-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-10-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/basic-aggregation.png" alt="basic aggregation">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="windowed-aggregations"><a class="anchor" href="#windowed-aggregations"></a><a class="link" href="#windowed-aggregations">Windowed Aggregations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default behavior of aggregations is to produce an output whose value
is an aggregation of all inputs seen to date each time an input is
consumed. This behavior can be controlled using windowed aggregations.</p>
</div>
<div class="sect2">
<h3 id="controlling-what-is-aggregated"><a class="anchor" href="#controlling-what-is-aggregated"></a><a class="link" href="#controlling-what-is-aggregated">Controlling <em>What</em> is Aggregated</a></h3>
<div class="paragraph">
<p>The first aspect describes the set of input values used in an
aggregation. The default behavior is for every input value to
contribute. In some cases it may be preferable to only include the N
most recent inputs, or to include every input since a particular event
occurred.</p>
</div>
</div>
<div class="sect2">
<h3 id="controlling-when-is-aggregated"><a class="anchor" href="#controlling-when-is-aggregated"></a><a class="link" href="#controlling-when-is-aggregated">Controlling <em>When</em> is Aggregated</a></h3>
<div class="paragraph">
<p>The second aspect describes when the result of the aggregation should be
produced. The default behavior is to produce an output value every time
an input value is consumed. In some cases it may be preferable to
produce an output value at the end of each day, when a particular event
occurs.</p>
</div>
</div>
<div class="sect2">
<h3 id="windowing-examples"><a class="anchor" href="#windowing-examples"></a><a class="link" href="#windowing-examples">Windowing Examples</a></h3>
<div class="paragraph">
<p>Aggregations may be windowed by providing a <em>window generator</em> for the
aggregation&#8217;s <code>window</code> parameter. For example the
<code>sliding(2, is_valid(Purchase))</code> window generator computes the sum of
the <em>two most recent</em> valid purchases.</p>
</div>
<div class="paragraph">
<p>The <code>sliding(n, bool)</code> window generator affects <em>what</em> is aggregated but
retains the default <em>when</em> behavior of producing an output associated
with each input.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">Purchase.amount | sum(window = sliding(2, is_valid(Purchase))</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Time</th>
<th class="tableblock halign-left valign-top">Purchase.amount</th>
<th class="tableblock halign-left valign-top">&#8230;&#8203; | sum(window = sliding(2,
is_valid(Purchase))</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012-02-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012-05-10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-11-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-10-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/windowing-example1.png" alt="windowing example1">
</div>
</div>
<div class="paragraph">
<p>The <code>yearly()</code> window generator can be used to compute the
total of all purchases at the beginning of each year.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">Purchase.amount | sum(window = since(yearly()))</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Time</th>
<th class="tableblock halign-left valign-top">&#8230;&#8203; | sum(window = since(yearly()))</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2016-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2017-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/windowing-example2.png" alt="windowing example2">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Going Deeper</div>
<div class="paragraph">
<p>Yearly windows produce values at the end of the window,
but when should we <em>stop</em> producing windows? The set of times associated
with events is finite and known when a computation takes place, but
there is an unbounded number of year boundaries.</p>
</div>
<div class="paragraph">
<p>To avoid producing unbounded results, Fenl limits "cron-style" windows
to time intervals that begin before the newest event and end after the
oldest event in the dataset, across all entities.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repeated-aggregation"><a class="anchor" href="#repeated-aggregation"></a><a class="link" href="#repeated-aggregation">Repeated Aggregation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Events may be aggregated multiple times. The events themselves are a
sequence of timestamped data for each entity. The result of the first
aggregation is the same — a sequence of timestamped data for each
entity. Applying an additional aggregation simply aggregates over those
times. For example, we can compute the average purchase amount sum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-fenl hljs" data-lang="fenl">Purchase.amount | sum() | mean()</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Time</th>
<th class="tableblock halign-left valign-top">Purchase.amount</th>
<th class="tableblock halign-left valign-top">&#8230;&#8203;| sum()</th>
<th class="tableblock halign-left valign-top">&#8230;&#8203; | mean()</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012-02-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012-05-10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-11-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.666</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-10-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/windowing-example3.png" alt="windowing example3">
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="temporal-aggregation.html">Temporal Computation</a></span>
  <span class="next"><a href="continuity.html">Continuity</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
&copy; Copyright The Kaskada Authors 
</footer><script src="../../../_/js/site.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script src="../../../_/js/vendor/fenl.min.js"></script>
<script>hljs.highlightAll();</script>
  </body>
</html>
