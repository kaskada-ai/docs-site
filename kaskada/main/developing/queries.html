<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Queries :: Kaskada Docs</title>
    <link rel="canonical" href="https://kaskada-ai.github.io/docs-site/kaskada/main/developing/queries.html">
    <link rel="prev" href="tables.html">
    <link rel="next" href="slices.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/vendor/tabs.css">
<link rel="shortcut icon" type="image/svg" href="/assets/images/favicon.svg">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HR9E2E6TG4"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-HR9E2E6TG4')</script>
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a
        class="navbar-item"
        href="https://kaskada-ai.github.io/"
        title="Kaskada AI"
      >
        <svg
          width="137"
          height="38"
          viewBox="0 0 137 38"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clip-path="url(#clip0_288_191)">
            <path
              d="M60.6005 12.2711C60.5761 12.2047 60.5306 12.1482 60.4709 12.1102C60.4113 12.0722 60.3409 12.0549 60.2705 12.0609H60.083C60.0142 12.0588 59.9465 12.0779 59.8888 12.1155C59.8312 12.153 59.7864 12.2074 59.7605 12.2711L53.8354 25.2482C53.8077 25.3021 53.7947 25.3622 53.7975 25.4227C53.8004 25.4832 53.8191 25.5419 53.8518 25.5929C53.8845 25.6438 53.9299 25.6853 53.9837 25.7131C54.0374 25.7409 54.0975 25.7541 54.1579 25.7514H55.8079C55.9297 25.7532 56.049 25.7164 56.1487 25.6463C56.2484 25.5762 56.3234 25.4762 56.3629 25.3609L60.0755 16.9348C60.0801 16.927 60.0867 16.9206 60.0946 16.9161C60.1025 16.9116 60.1114 16.9093 60.1205 16.9093C60.1295 16.9093 60.1384 16.9116 60.1463 16.9161C60.1542 16.9206 60.1608 16.927 60.1655 16.9348L62.0255 21.0652C62.0295 21.0736 62.0313 21.083 62.0305 21.0923C62.0298 21.1016 62.0265 21.1105 62.0212 21.1181C62.0158 21.1258 62.0086 21.1319 62.0001 21.1358C61.9916 21.1397 61.9823 21.1412 61.973 21.1403H59.0779C59.0661 21.1421 59.0546 21.1463 59.0444 21.1526C59.0342 21.1589 59.0253 21.1672 59.0183 21.177C59.0113 21.1868 59.0063 21.1979 59.0037 21.2097C59.0011 21.2214 59.0008 21.2336 59.0029 21.2454L59.393 23.213C59.3939 23.2229 59.3968 23.2325 59.4014 23.2413C59.4061 23.25 59.4125 23.2578 59.4201 23.2641C59.4278 23.2703 59.4366 23.275 59.4461 23.2779C59.4556 23.2807 59.4656 23.2817 59.4755 23.2806H62.978C62.9884 23.2817 62.9984 23.2849 63.0074 23.2901C63.0165 23.2953 63.0243 23.3023 63.0305 23.3107L63.9455 25.3609C64.0805 25.6312 64.2155 25.7514 64.5005 25.7514H66.1506C66.211 25.7541 66.2711 25.7409 66.3248 25.7131C66.3785 25.6853 66.424 25.6438 66.4566 25.5929C66.4893 25.5419 66.508 25.4832 66.5109 25.4227C66.5138 25.3622 66.5007 25.3021 66.4731 25.2482L60.6005 12.2711ZM73.4257 17.7684C71.8806 17.13 71.1756 16.5142 71.1756 15.6055C71.1756 14.9897 71.7756 14.2537 72.8557 14.2537C73.9357 14.2537 75.3532 15.23 75.5032 15.3201C75.6532 15.4103 76.0132 15.3201 76.1782 15.0948L76.8982 13.9909C77.0332 13.8031 76.9732 13.4727 76.7857 13.3601C76.4107 13.0597 74.9107 12.0684 72.9757 12.0684C69.9456 12.0684 68.7006 14.051 68.7006 15.7707C68.7006 18.0462 70.4856 19.2028 72.2781 19.9312C73.8832 20.5921 74.7007 21.2605 74.7007 22.2443C74.7007 23.0703 73.9507 23.7312 72.9757 23.7312C71.7381 23.7312 70.2006 22.6047 70.0956 22.5296C70.0459 22.4916 69.9886 22.4647 69.9277 22.4508C69.8667 22.4369 69.8034 22.4364 69.7422 22.4492C69.681 22.4621 69.6232 22.488 69.5729 22.5252C69.5226 22.5624 69.4809 22.61 69.4506 22.6648L68.7606 23.8664C68.5956 24.1668 68.6856 24.2719 68.8581 24.4447C69.2331 24.8201 70.6581 25.9466 73.0582 25.9466C75.7432 25.9466 77.4382 24.1142 77.4382 22.1316C77.4232 19.6383 75.2857 18.5194 73.4407 17.7684H73.4257ZM115.404 12.2486H110.889C110.795 12.2544 110.706 12.297 110.643 12.3673C110.58 12.4375 110.547 12.5297 110.551 12.6241V25.3834C110.547 25.4778 110.58 25.57 110.643 25.6402C110.706 25.7105 110.795 25.7531 110.889 25.7589H115.404C119.079 25.7589 122.094 22.7324 122.094 18.985C122.094 15.2375 119.101 12.2411 115.426 12.2411L115.404 12.2486ZM115.179 23.3933H113.004V14.5842H115.179C117.654 14.5842 119.454 16.4767 119.454 18.9775C119.454 21.4782 117.676 23.3933 115.201 23.3933H115.179ZM46.7628 18.6245L51.7278 12.9545C51.9753 12.6616 51.7878 12.2561 51.4278 12.2561H49.4778C49.4067 12.2578 49.3369 12.2764 49.2743 12.3104C49.2118 12.3443 49.1581 12.3926 49.1178 12.4514L43.9502 18.3241C43.8773 18.4063 43.8357 18.5118 43.833 18.6217C43.8302 18.7317 43.8664 18.8391 43.9352 18.9249L49.2903 25.6087C49.3329 25.6551 49.3853 25.6913 49.4437 25.7147C49.5021 25.7381 49.565 25.7481 49.6278 25.7439H51.7503C51.8285 25.7432 51.905 25.7211 51.9714 25.68C52.0379 25.6389 52.0919 25.5803 52.1274 25.5106C52.163 25.441 52.1788 25.3629 52.1732 25.2848C52.1675 25.2068 52.1406 25.1318 52.0953 25.068L46.7628 18.6245ZM42.3002 12.2411H40.6202C40.5598 12.2411 40.5 12.2532 40.4444 12.2768C40.3888 12.3003 40.3385 12.3349 40.2966 12.3783C40.2546 12.4218 40.2217 12.4732 40.2 12.5297C40.1783 12.5861 40.1682 12.6463 40.1702 12.7067V25.2858C40.1682 25.3462 40.1783 25.4064 40.2 25.4628C40.2217 25.5192 40.2546 25.5707 40.2966 25.6141C40.3385 25.6576 40.3888 25.6921 40.4444 25.7157C40.5 25.7393 40.5598 25.7514 40.6202 25.7514H42.3002C42.4203 25.7457 42.5337 25.6943 42.6173 25.6078C42.7009 25.5213 42.7484 25.4061 42.7502 25.2858V12.7142C42.7503 12.5925 42.7037 12.4755 42.6199 12.3874C42.5361 12.2993 42.4216 12.2469 42.3002 12.2411ZM87.7884 18.6095L92.7609 12.9395C92.8169 12.8809 92.8543 12.8071 92.8687 12.7274C92.883 12.6476 92.8736 12.5654 92.8417 12.4909C92.8097 12.4165 92.7565 12.3531 92.6888 12.3087C92.6211 12.2642 92.5419 12.2407 92.4609 12.2411H90.5109C90.4398 12.2428 90.37 12.2614 90.3074 12.2954C90.2449 12.3293 90.1912 12.3776 90.1509 12.4364L84.9758 18.3241C84.9039 18.4072 84.8637 18.5132 84.8623 18.6231C84.861 18.7331 84.8985 18.84 84.9683 18.9249L90.3159 25.6087C90.3585 25.6551 90.4109 25.6913 90.4693 25.7147C90.5277 25.7381 90.5906 25.7481 90.6534 25.7439H92.7759C92.8541 25.7432 92.9306 25.7211 92.997 25.68C93.0635 25.6389 93.1175 25.5803 93.1531 25.5106C93.1886 25.441 93.2044 25.3629 93.1988 25.2848C93.1931 25.2068 93.1662 25.1318 93.1209 25.068L87.7884 18.6095ZM83.3258 12.2411H81.6533C81.5929 12.2411 81.5331 12.2532 81.4775 12.2768C81.4219 12.3003 81.3716 12.3349 81.3297 12.3783C81.2877 12.4218 81.2548 12.4732 81.2331 12.5297C81.2114 12.5861 81.2013 12.6463 81.2033 12.7067V25.2858C81.2013 25.3462 81.2114 25.4064 81.2331 25.4628C81.2548 25.5192 81.2877 25.5707 81.3297 25.6141C81.3716 25.6576 81.4219 25.6921 81.4775 25.7157C81.5331 25.7393 81.5929 25.7514 81.6533 25.7514H83.3258C83.4459 25.7457 83.5593 25.6943 83.6429 25.6078C83.7265 25.5213 83.774 25.4061 83.7758 25.2858V12.7142C83.7759 12.5925 83.7293 12.4755 83.6455 12.3874C83.5617 12.2993 83.4472 12.2469 83.3258 12.2411ZM101.634 12.2636C101.61 12.1985 101.565 12.1429 101.507 12.105C101.449 12.0672 101.38 12.049 101.311 12.0533H101.116C101.047 12.0513 100.98 12.0704 100.922 12.1079C100.864 12.1455 100.82 12.1998 100.794 12.2636L94.8685 25.2407C94.756 25.4885 94.906 25.7439 95.1985 25.7439H96.8485C96.9703 25.7457 97.0896 25.7089 97.1893 25.6388C97.289 25.5687 97.364 25.4687 97.4035 25.3533L101.124 16.9273C101.128 16.9211 101.133 16.916 101.14 16.9125C101.146 16.9089 101.154 16.9071 101.161 16.9071C101.168 16.9071 101.176 16.9089 101.182 16.9125C101.189 16.916 101.194 16.9211 101.199 16.9273L103.059 21.0577C103.063 21.0661 103.064 21.0754 103.064 21.0847C103.063 21.094 103.06 21.103 103.054 21.1106C103.049 21.1183 103.042 21.1244 103.033 21.1283C103.025 21.1321 103.015 21.1337 103.006 21.1328H100.096C100.084 21.1346 100.073 21.1388 100.062 21.1451C100.052 21.1514 100.043 21.1597 100.036 21.1695C100.029 21.1793 100.024 21.1904 100.022 21.2022C100.019 21.2139 100.019 21.2261 100.021 21.2379L100.411 23.2055C100.416 23.2241 100.426 23.2407 100.441 23.2529C100.456 23.265 100.474 23.2721 100.494 23.2731H103.996C104.007 23.273 104.017 23.2757 104.026 23.281C104.036 23.2863 104.043 23.2939 104.049 23.3031L104.964 25.3533C105.099 25.6237 105.234 25.7439 105.519 25.7439H107.176C107.237 25.7466 107.297 25.7334 107.35 25.7056C107.404 25.6778 107.45 25.6363 107.482 25.5854C107.515 25.5344 107.534 25.4757 107.536 25.4152C107.539 25.3547 107.526 25.2945 107.499 25.2407L101.634 12.2636ZM136.622 25.2407L130.756 12.2636C130.732 12.1972 130.687 12.1407 130.627 12.1027C130.567 12.0647 130.497 12.0474 130.426 12.0533H130.239C130.17 12.0513 130.102 12.0704 130.045 12.1079C129.987 12.1455 129.942 12.1998 129.916 12.2636L123.991 25.2407C123.964 25.2945 123.951 25.3547 123.954 25.4152C123.956 25.4757 123.975 25.5344 124.008 25.5854C124.04 25.6363 124.086 25.6778 124.14 25.7056C124.193 25.7334 124.253 25.7466 124.314 25.7439H125.964C126.086 25.7457 126.205 25.7089 126.305 25.6388C126.404 25.5687 126.479 25.4687 126.519 25.3533L130.231 16.9273C130.236 16.9195 130.243 16.913 130.251 16.9086C130.259 16.9041 130.267 16.9018 130.276 16.9018C130.286 16.9018 130.294 16.9041 130.302 16.9086C130.31 16.913 130.317 16.9195 130.321 16.9273L132.182 21.0577C132.186 21.0661 132.187 21.0754 132.187 21.0847C132.186 21.094 132.183 21.103 132.177 21.1106C132.172 21.1183 132.165 21.1244 132.156 21.1283C132.148 21.1321 132.138 21.1337 132.129 21.1328H129.226C129.215 21.1346 129.203 21.1388 129.193 21.1451C129.183 21.1514 129.174 21.1597 129.167 21.1695C129.16 21.1793 129.155 21.1904 129.152 21.2022C129.15 21.2139 129.149 21.2261 129.151 21.2379L129.541 23.2055C129.542 23.2154 129.545 23.225 129.55 23.2338C129.555 23.2425 129.561 23.2503 129.569 23.2565C129.576 23.2628 129.585 23.2675 129.595 23.2704C129.604 23.2732 129.614 23.2741 129.624 23.2731H133.127C133.137 23.2742 133.147 23.2774 133.156 23.2826C133.165 23.2878 133.173 23.2948 133.179 23.3031L134.094 25.3533C134.229 25.6237 134.364 25.7439 134.649 25.7439H136.299C136.358 25.7459 136.417 25.7326 136.47 25.7051C136.523 25.6777 136.568 25.6371 136.6 25.5872C136.632 25.5373 136.652 25.4799 136.655 25.4205C136.659 25.3611 136.647 25.3018 136.622 25.2482V25.2407Z"
              fill="#26364A"
            />
            <path
              d="M31.8014 27.8616C30.3389 26.2245 26.9263 22.4545 25.0513 20.3968C25.0343 20.3768 25.0125 20.3616 24.9878 20.3527C24.9632 20.3439 24.9367 20.3416 24.9109 20.3461C24.8851 20.3507 24.8609 20.3619 24.8408 20.3787C24.8207 20.3955 24.8054 20.4173 24.7963 20.4419L23.5738 23.4458C23.5548 23.4905 23.549 23.5397 23.557 23.5876C23.5649 23.6355 23.5864 23.6801 23.6188 23.7162C25.7413 26.0442 28.8088 29.4237 29.3938 30.0996C29.8427 30.5968 30.0849 31.2468 30.0709 31.9169C30.057 32.5869 29.7879 33.2263 29.3188 33.7043C28.8572 34.1703 28.2353 34.4422 27.5801 34.4645C26.925 34.4869 26.2861 34.2579 25.7938 33.8245C24.7513 32.9308 17.2062 26.2095 17.2062 26.2095C17.2062 26.2095 29.7014 12.4889 31.7864 10.1233C33.8714 7.75769 33.8264 4.19049 31.6064 1.93753C29.3863 -0.315434 25.9513 -0.337964 23.6038 1.67468C21.2562 3.68733 15.0011 9.31223 15.0011 9.31223C15.0011 9.31223 9.75106 3.45453 8.38604 2.01263C7.02102 0.570732 5.02599 0.0900996 3.19597 0.826068C1.36594 1.56204 0.300926 3.37943 0.300926 5.31698V32.7731C0.293497 33.7184 0.572711 34.6438 1.10167 35.4269C1.63063 36.2099 2.38443 36.8139 3.26347 37.1589C5.0635 37.8648 7.05102 37.3691 8.37854 35.9573C9.12855 35.1612 11.1236 32.9533 12.7286 31.181C12.7608 31.1418 12.7819 31.0946 12.7898 31.0444C12.7977 30.9943 12.7921 30.9429 12.7736 30.8956L11.4236 28.0269C11.4132 28.0043 11.3973 27.9847 11.3775 27.9698C11.3577 27.9549 11.3344 27.9451 11.3099 27.9414C11.2854 27.9377 11.2603 27.9401 11.237 27.9485C11.2136 27.9568 11.1927 27.9709 11.1761 27.9893C9.37606 29.9794 6.39851 33.2688 5.97101 33.7269C5.3485 34.3802 4.65849 34.1624 4.45599 34.0798C4.19282 33.9809 3.96658 33.803 3.80817 33.5704C3.64977 33.3379 3.56693 33.0621 3.57097 32.7806V5.19682C3.56347 4.31065 4.17848 3.98022 4.50099 3.87508C4.82349 3.76994 5.446 3.70235 5.87351 4.16046C6.17351 4.48338 19.3137 18.985 19.3137 18.985L14.7386 24.0166C14.7386 24.0166 11.3111 21.0126 10.8836 20.5921C10.4561 20.1715 10.1561 19.6008 10.1561 18.9699C10.1579 18.6638 10.2236 18.3613 10.3489 18.082C10.4742 17.8027 10.6563 17.5526 10.8836 17.3478C10.9736 17.2727 11.5286 16.762 12.3836 15.996C12.421 15.9615 12.4478 15.9171 12.4611 15.8679C12.4744 15.8188 12.4735 15.7669 12.4586 15.7182L11.4236 12.7292C11.4165 12.7044 11.4031 12.6818 11.3848 12.6637C11.3664 12.6455 11.3437 12.6324 11.3188 12.6257C11.294 12.6189 11.2678 12.6186 11.2428 12.6249C11.2177 12.6312 11.1948 12.6439 11.1761 12.6616C10.3511 13.3901 9.33106 14.2913 8.72355 14.8545C7.56853 15.9284 6.88602 17.3929 6.88602 18.9624C6.89062 19.7374 7.05638 20.5029 7.37275 21.2101C7.68912 21.9174 8.14916 22.5509 8.72355 23.0703C9.21856 23.5209 22.5012 35.349 23.6263 36.2877C24.7513 37.2265 26.1163 37.7747 27.4963 37.7747C28.2662 37.7753 29.0285 37.6229 29.7392 37.3264C30.4498 37.0299 31.0947 36.5952 31.6364 36.0474C33.8564 33.7944 33.9014 30.2047 31.8014 27.8616ZM17.2062 11.7154C20.9937 8.35097 25.1938 4.63358 25.7563 4.15295C26.8063 3.27429 28.3288 3.30433 29.2813 4.2731C30.2339 5.24188 30.2564 6.82646 29.3563 7.87785C28.4563 8.92923 21.5262 16.5142 21.5262 16.5142L20.1462 14.9897L17.2062 11.7154Z"
              fill="#F14C4C"
            />
          </g>
          <defs>
            <clipPath id="clip0_288_191">
              <rect width="136.952" height="38" fill="white" />
            </clipPath>
          </defs>
        </svg>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://github.com/kaskada-ai/kaskada">Get Started</a>
          </span>
        </div>
        <a class="navbar-link is-active" href="https://kaskada-ai.github.io/docs-site">Docs</a>
        <a class="navbar-link" href="https://kaskada-ai.github.io/blog">Blog</a>
        <a class="navbar-link" href="https://kaskada-ai.github.io/community">Community</a>
        <div class="navbar-item icons">
          <a class="navbar-link" href="https://github.com/kaskada-ai/kaskada" title="Github">
            <svg
              width="2em"
              height="2em"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M15.9633 4C9.3578 4 4 9.28691 4 15.805C4 21.0195 7.44954 25.4373 12.1468 27.0306C12.7339 27.1031 12.9541 26.7409 12.9541 26.4512C12.9541 26.1616 12.9541 25.4373 12.9541 24.4234C9.65138 25.1476 8.91743 22.8301 8.91743 22.8301C8.40367 21.454 7.59633 21.0919 7.59633 21.0919C6.49541 20.3677 7.66972 20.3677 7.66972 20.3677C8.84404 20.4401 9.50459 21.5989 9.50459 21.5989C10.6055 23.4095 12.2936 22.9025 12.9541 22.6128C13.0275 21.8162 13.3945 21.3092 13.6881 21.0195C11.0459 20.7298 8.25688 19.7159 8.25688 15.1532C8.25688 13.8496 8.69725 12.8357 9.50459 11.9666C9.43119 11.7493 8.99083 10.5181 9.65138 8.92479C9.65138 8.92479 10.6789 8.6351 12.9541 10.156C13.9083 9.86629 14.9358 9.79387 15.9633 9.79387C16.9908 9.79387 18.0183 9.93872 18.9725 10.156C21.2477 8.6351 22.2752 8.92479 22.2752 8.92479C22.9358 10.5181 22.4954 11.7493 22.422 12.039C23.156 12.8357 23.6697 13.922 23.6697 15.2256C23.6697 19.7883 20.8807 20.7298 18.2385 21.0195C18.6789 21.3816 19.0459 22.1058 19.0459 23.1922C19.0459 24.7855 19.0459 26.0167 19.0459 26.4512C19.0459 26.7409 19.2661 27.1031 19.8532 27.0306C24.6239 25.4373 28 21.0195 28 15.805C27.9266 9.28691 22.5688 4 15.9633 4Z"
                fill="currentColor"
              />
            </svg>
          </a>
          <a class="navbar-link" href="https://twitter.com/kaskadainc" title="Twitter">
            <svg
              width="2em"
              height="2em"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M12.2249 25.4978C20.904 25.4978 25.6531 18.3791 25.6531 12.2162C25.6531 12.0159 25.6531 11.8156 25.6439 11.6154C26.5642 10.9599 27.3649 10.1315 28 9.19389C27.1533 9.56712 26.2421 9.81291 25.2849 9.93125C26.2605 9.35775 27.006 8.43832 27.3649 7.34592C26.4538 7.88302 25.4414 8.26536 24.3645 8.47473C23.4994 7.5644 22.2753 7 20.9224 7C18.3177 7 16.2009 9.09375 16.2009 11.67C16.2009 12.0341 16.2469 12.3891 16.3205 12.7351C12.3998 12.5439 8.92077 10.6777 6.59224 7.85571C6.18727 8.54756 5.95718 9.34864 5.95718 10.2044C5.95718 11.8247 6.79472 13.2539 8.05562 14.0914C7.28251 14.0641 6.55542 13.8548 5.92037 13.5088C5.92037 13.527 5.92037 13.5453 5.92037 13.5726C5.92037 15.8302 7.54942 17.7237 9.70308 18.1515C9.30732 18.2607 8.89316 18.3154 8.46058 18.3154C8.15686 18.3154 7.86234 18.2881 7.57703 18.2334C8.17527 20.0905 9.92397 21.4378 11.9856 21.4742C10.3657 22.7305 8.33173 23.4769 6.12285 23.4769C5.7455 23.4769 5.36815 23.4587 5 23.4132C7.08003 24.7241 9.56503 25.4978 12.2249 25.4978Z"
                fill="currentColor"
              />
            </svg>
          </a>
          <a class="navbar-link" href="https://www.linkedin.com/company/kaskadainc" title="LinkedIn">
            <svg
              width="2em"
              height="2em"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M9.90155 25.0996H5.34197V10.5554H9.90155V25.0996ZM7.62176 8.58231C6.1399 8.58231 5 7.39847 5 5.98915C5 4.52345 6.19689 3.396 7.62176 3.396C9.10363 3.396 10.2435 4.57983 10.2435 5.98915C10.3005 7.39847 9.10363 8.58231 7.62176 8.58231ZM27 25.0996H22.4404V18.053C22.4404 16.3618 22.3834 14.2196 20.0466 14.2196C17.6528 14.2196 17.3109 16.0799 17.3109 17.9402V25.0996H12.7513V10.5554H17.1399V12.5284H17.1969C17.8238 11.401 19.3057 10.1607 21.5285 10.1607C26.1451 10.1607 27 13.1485 27 17.0946V25.0996Z"
                fill="currentColor"
              />
            </svg>
          </a>
        </div>
        
       <div class="navbar-item navbar-item-lower-case search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
       </div>

      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="kaskada" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../overview/what-is-kaskada.html">Kaskada Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Overview</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/what-is-kaskada.html">What Is Kaskada?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/faq.html">Frequently Asked Questions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/hello-world-jupyter.html">Hello World (Jupyter)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/hello-world-cli.html">Hello World (CLI)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../installing.html">Installing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../loading-data.html">Loading Data</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Examples</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/kaskada-ai/kaskada/blob/main/examples/Kaskada%20Demo%20for%20Event%20Processing%20and%20Time-centric%20Calculations.ipynb">Overview ↪</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/kaskada-ai/kaskada/blob/main/examples/ML_example.ipynb">Real-time ML ↪</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/kaskada-ai/kaskada/blob/main/examples/Customer_Retention_(OSS).ipynb">Customer Retention ↪</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/kaskada-ai/kaskada/blob/main/examples/pulsar-materialize/notebooks/Materialize_to_Pulsar.ipynb">Materializing to Pulsar ↪</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="tables.html">Tables</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="queries.html">Queries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="slices.html">Slices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="views.html">Views</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="materializations.html">Materializations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://kaskada.readthedocs.io/en/latest/autoapi/kaskada/index.html">Python client ↪</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://buf.build/kaskada/kaskada">Protobuf API ↪</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Integrating</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrating/apache-pulsar.html">Apache Pulsar</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrating/apache-cassandra.html">Apache Cassandra</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrating/redis.html">Redis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrating/aws-redshift.html">AWS Redshift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integrating/snowflake.html">Snowflake</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tools and Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools-and-resources/training-realtime-ml-models.html">Training real-time ML models</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools-and-resources/exporting-for-training.html">Example Modeling Problem</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Query Syntax (Fenl)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/fenl-quick-start.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/data-model.html">Data Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/syntax.html">Syntax</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/entities.html">Enities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/temporal-aggregation.html">Temporal Computation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/aggregation-and-windowing.html">Aggregation and Windowing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/continuity.html">Continuity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/catalog.html">Function Catalog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/fenl-faq.html">Fenl FAQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fenl/working-with-records.html">Working with Records</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/logs.html">Engine and manager logs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Kaskada Documentation</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../overview/what-is-kaskada.html">Kaskada Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../overview/what-is-kaskada.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../overview/what-is-kaskada.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../overview/what-is-kaskada.html">Kaskada Documentation</a></li>
    <li>Reference</li>
    <li><a href="queries.html">Queries</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/kaskada-ai/kaskada/edit/main/docs-src/modules/developing/pages/queries.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Queries</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Kaskada computes results from the data you&#8217;ve loaded by executing <em>queries</em>.
A query describes a computation to perform and configures how the query should be executed.</p>
</div>
<div class="paragraph">
<p>Kaskada queries are witten in a language called Fenl, which is designed to make it easy to describe computations over events.
To learn more about Fenl:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="../fenl/fenl-quick-start.html" class="xref page">Quick Start</a> is an overview of the query language.</p>
</li>
<li>
<p>The <a href="../fenl/catalog.html" class="xref page">Function Catalog</a> documents the operations and functions provided by Fenl.</p>
</li>
<li>
<p>The <a href="../fenl/fenl-faq.html" class="xref page">FAQ</a> answers some comment questions about using Fenl.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-syntax-quickstart"><a class="anchor" href="#query-syntax-quickstart"></a><a class="link" href="#query-syntax-quickstart">Query syntax quickstart</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kaskada&#8217;s query language builds on the lessons of 50+ years of query language design to provide a declarative, composable, easy-to-read, and type-safe way of describing computations related to time.
The following is a quick overview of the query language&#8217;s main features and syntax.</p>
</div>
<div class="sect2">
<h3 id="viewing-and-filtering-the-contents-of-a-table"><a class="anchor" href="#viewing-and-filtering-the-contents-of-a-table"></a><a class="link" href="#viewing-and-filtering-the-contents-of-a-table">Viewing and filtering the contents of a table</a></h3>
<div class="paragraph">
<p>Kaskada queries are built by composing simple expressions.
Every expression returns a timeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">Purchase | when(Purchase.amount &gt; 10)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we start with the expression <code>Purchase</code> (the timeline of all purchase events) then filter it using <code><a href="../fenl/catalog.html#when" class="xref page">when()</a></code>.
The result is a timeline of purchase events whose amount is greater than 10.</p>
</div>
</div>
<div class="sect2">
<h3 id="stateful-aggregations"><a class="anchor" href="#stateful-aggregations"></a><a class="link" href="#stateful-aggregations">Stateful aggregations</a></h3>
<div class="paragraph">
<p>Aggregate events to produce a continuous timeline whose value can be observed at arbitrary points in time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">{ max_verified_review_to_date: Review.stars | when(Review.verified) | max() }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">What are the curly brackets for?</div>
<div class="paragraph">
<p>Every query needs to return a <a href="../fenl/working-with-records.html" class="xref page">Record</a>.
Records allow one or more values to be grouped into a single row.
You can create a record using the syntax <code>{key: value, key2: value2}</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example we first filter the timeline of <code>Review</code> events to only include verified reviews, then aggregate the filtered results using the <code><a href="../fenl/catalog.html#max" class="xref page">max()</a></code> aggregation.
The resulting timeline describes the maximum number of stars as-of every point in time.</p>
</div>
</div>
<div class="sect2">
<h3 id="automatic-joins"><a class="anchor" href="#automatic-joins"></a><a class="link" href="#automatic-joins">Automatic joins</a></h3>
<div class="paragraph">
<p>Every expression is associated with an <a href="../fenl/entities.html" class="xref page">entity</a>, allowing tables and expressions to be automatically joined. Entities eliminate redundant boilerplate code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">{ purchases_per_page_view: count(Purchase) / count(Pageview) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we&#8217;ve used the <code><a href="../fenl/catalog.html#count" class="xref page">count()</a></code> aggregation to divide the number of purchases up to each point in time by the number of pageviews up to the same point in time.
The result is a timeline describing how each user&#8217;s purchase-per-pageview changes over time.
Since both the <code>Purchase</code> and <code>Pageview</code> tables have the same entity, we can easily combine them.</p>
</div>
</div>
<div class="sect2">
<h3 id="event-based-windowing"><a class="anchor" href="#event-based-windowing"></a><a class="link" href="#event-based-windowing">Event-based windowing</a></h3>
<div class="paragraph">
<p>Collect events as you move through time, and aggregate them with respect to other events. Ordered aggregation makes it easy to describe temporal interactions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">{
  pageviews_since_last_purchase:  count(Pageview, window=since(Purchase)),
  spend_since_last_review:        count(Purchase, window=since(Review)),
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, aggregations are applied from the beginning of time, but here we&#8217;ve used the <code><a href="../fenl/catalog.html#since" class="xref page">since()</a></code> window function to configure the aggregation to reset each time there&#8217;s a <code>Purchase</code> or <code>Review</code>, respectively.</p>
</div>
</div>
<div class="sect2">
<h3 id="pipelined-operations"><a class="anchor" href="#pipelined-operations"></a><a class="link" href="#pipelined-operations">Pipelined operations</a></h3>
<div class="paragraph">
<p>Pipe syntax allows multiple operations to be chained together. Write your operations in the same order you think about them. It&#8217;s timelines all the way down, making it easy to aggregate the results of aggregations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">{
  largest_spend_over_2_purchases: purchase.amount
  | when(Purchase.category == "food")
  | sum(window=sliding(2, Purchase.category == "food")) # Inner aggregation
  | max()                                               # Outer aggregation
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="row-generators"><a class="anchor" href="#row-generators"></a><a class="link" href="#row-generators">Row generators</a></h3>
<div class="paragraph">
<p>Pivot from events to time-series. Unlike grouped aggregates, <a href="../fenl/catalog.html#tick-functions" class="xref page">tick generators</a> such as <code><a href="../fenl/catalog.html#daily" class="xref page">daily()</a></code> produce rows even when there&#8217;s no input, allowing you to react when something <em>doesn&#8217;t</em> happen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">{
  signups_per_hour: count(Signups, window=since(daily()))
  | when(daily())
  | mean()
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="continuous-expressions"><a class="anchor" href="#continuous-expressions"></a><a class="link" href="#continuous-expressions">Continuous expressions</a></h3>
<div class="paragraph">
<p>Observe the value of aggregations at arbitrary points in time. Timelines are either “<a href="../fenl/continuity.html#discrete-expressions" class="xref page">discrete</a>” (instantaneous values or events) or “<a href="../fenl/continuity.html#continuous-expressions" class="xref page">continuous</a>” (values produced by a stateful aggregations). Continuous timelines let you combine aggregates computed from different event sources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">let product_average = Review.stars
| with_key(Review.product_id)
| mean()

in { average_product_review: product_average | lookup(Purchase.product_id)) }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the <code><a href="../fenl/catalog.html#lookup" class="xref page">lookup()</a></code> function is used to observe a value computed for a different entity.
The variable <code>product_average</code> computes the average review using the product&#8217;s ID as entity.
The lookup starts with each <code>purchase</code>, then looks up the current value of the product&#8217;s average review, for the procduct ID specified in the purchase.</p>
</div>
</div>
<div class="sect2">
<h3 id="native-time-travel"><a class="anchor" href="#native-time-travel"></a><a class="link" href="#native-time-travel">Native time travel</a></h3>
<div class="paragraph">
<p>Shifting values forward (but not backward) in time, allows you to combine different temporal contexts without the risk of temporal leakage. Shifted values make it easy to compare a value “now” to a value from the past.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">let purchases_now = count(Purchase)
let purchases_yesterday =
   purchases_now | shift_by(days(1))

in { purchases_in_last_day: purchases_now - purchases_yesterday }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we take the timeline produced by <code>purchases_now</code> and move it forward in time by one day using the <code><a href="../fenl/catalog.html#shift-by" class="xref page">shift_by()</a></code> function.
We then subtract the shifted value from the original, unshifted value</p>
</div>
</div>
<div class="sect2">
<h3 id="simple-composable-syntax"><a class="anchor" href="#simple-composable-syntax"></a><a class="link" href="#simple-composable-syntax">Simple, composable syntax</a></h3>
<div class="paragraph">
<p>It is functions all the way down. No global state, no dependencies to manage, and no spooky action at a distance. Quickly understand what a query is doing, and painlessly refactor to make it DRY.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl"># How many big purchases happen each hour and where?
let cadence = hourly()
# Anything can be named and re-used
let hourly_big_purchases = Purchase
| when(Purchase.amount &gt; 10)
# Filter anywhere
| count(window=since(cadence))
# Aggregate anything
| when(cadence)
# No choosing between “when” &amp; “having”

in {hourly_big_purchases}
# Records are just another type
| extend({
  # …modify them sequentially
  last_visit_region: last(Pageview.region)
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-how-queries-are-computed"><a class="anchor" href="#configuring-how-queries-are-computed"></a><a class="link" href="#configuring-how-queries-are-computed">Configuring how queries are computed</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A given query can be computed in different ways.</p>
</div>
<div class="sect2">
<h3 id="configuring-how-timelines-are-converted-into-tables"><a class="anchor" href="#configuring-how-timelines-are-converted-into-tables"></a><a class="link" href="#configuring-how-timelines-are-converted-into-tables">Configuring how timelines are converted into tables</a></h3>
<div class="paragraph">
<p>You can either return a table describing each change in the timeline, or a table describing the "final" value of the timeline.</p>
</div>
<div class="paragraph">
<p>Every query produces a timeline which may be returned in two different ways&#8201;&#8212;&#8201;the final results (at a specific time) or all historic results.
The "result behavior" configures which results are produced.
Queries for historic results return the full history of how the values changed over time for each entity.
Queries for final results return the latest result for each entity at the specified time (default is after all events have been processed).</p>
</div>
<div class="paragraph">
<p>You determine which type of query to execute using the "result behavior" configuration at query time.
By default, historical results are returned.
To return final results, you must configure the <code>final-results</code> behavior:</p>
</div>
<div id="tabs-1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-1-jupyter" class="tab">
<p>Jupyter</p>
</li>
<li id="tabs-1-python" class="tab">
<p>Python</p>
</li>
<li id="tabs-1-cli" class="tab">
<p>CLI</p>
</li>
</ul>
</div>
<div id="tabs-1-jupyter--panel" class="tabpanel" aria-labelledby="tabs-1-jupyter">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">%%fenl --result-behavior final-results
{
    time: Purchase.purchase_time,
    entity: Purchase.customer_id,
    max_amount: Purchase.amount | max(),
    min_amount: Purchase.amount | min(),
}</code></pre>
</div>
</div>
</div>
<div id="tabs-1-python--panel" class="tabpanel" aria-labelledby="tabs-1-python">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from kaskada import compute

query = """{
  time: Purchase.purchase_time,
  entity: Purchase.customer_id,
  max_amount: last(Purchase.amount) | max(),
  min_amount: Purchase.amount | min()
}"""

resp = query.create_query(expression=query, result_behavior="final-results")</code></pre>
</div>
</div>
</div>
<div id="tabs-1-cli--panel" class="tabpanel" aria-labelledby="tabs-1-cli">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl"># query.txt
{
  time: Purchase.purchase_time,
  entity: Purchase.customer_id,
  max_amount: last(Purchase.amount) | max(),
  min_amount: Purchase.amount | min()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat query.fenl | kaskada-cli query run --result-behavior final-results</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="querying-with-python"><a class="anchor" href="#querying-with-python"></a><a class="link" href="#querying-with-python">Querying with Python</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using python directly is one way to write queries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">from kaskada import compute
from kaskada.api.session import LocalBuilder

session = LocalBuilder().build()

query = """{
  time: Purchase.purchase_time,
  entity: Purchase.customer_id,
  max_amount: last(Purchase.amount) | max(),
  min_amount: Purchase.amount | min()
}"""

response_parquet = compute.query(query = query).output_to.object_store.output_paths[0]

# (Optional) view results as a Pandas dataframe.
import pandas
pandas.read_parquet(response_parquet)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns a dataframe with the results of the query.</p>
</div>
<div class="sect2">
<h3 id="optional-parameters-with-python"><a class="anchor" href="#optional-parameters-with-python"></a><a class="link" href="#optional-parameters-with-python">Optional Parameters (with Python)</a></h3>
<div class="paragraph">
<p>When querying directly from python, the following optional parameters
are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>with_tables</strong>: A list of tables to use in the query, in addition to
the tables stored in the system.</p>
</li>
<li>
<p><strong>with_views</strong>: A list of views to use in the query, in addition to the
views stored in the system.</p>
</li>
<li>
<p><strong>result_behavior</strong>: Determines which results are returned. Either
<code>"all-results"</code> <em>(default)</em>, or <code>"final-results"</code> which returns only the
final values for each entity.</p>
</li>
<li>
<p><strong>response_as</strong>: Determines how the response is returned. Either
<code>"parquet"</code> <em>(default)</em> or <code>"redis-bulk"</code>.</p>
<div class="ulist">
<ul>
<li>
<p>If <code>"redis-bulk"</code>, result_behavior is assumed to be
<code>"final-results"</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>data_token_id</strong>: Enables repeatable queries. Queries performed against
the same data token always run on the same input data.</p>
</li>
<li>
<p><strong>limits</strong>: Configures limits on the output set.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="querying-with-fenlmagic"><a class="anchor" href="#querying-with-fenlmagic"></a><a class="link" href="#querying-with-fenlmagic">Querying with fenlmagic</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the fenlmagic IPython extension makes iterating on queries easier.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The fenlmagic IPython extension is optional and isn&#8217;t required
to use Kaskada. Feel free to use whichever client interface fits your
workflow.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can make Fenl queries by prefixing a query block with <code>%%fenl</code>. The
query results will be computed and returned as a Pandas dataframe. The
query content starts on the next line and includes the rest of the code
block&#8217;s contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">%%fenl
{
    time: Purchase.purchase_time,
    entity: Purchase.customer_id,
    max_amount: Purchase.amount | max(),
    min_amount: Purchase.amount | min(),
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns a dataframe with the results of the query.</p>
</div>
<div class="sect2">
<h3 id="optional-parameters-with-fenlmagic"><a class="anchor" href="#optional-parameters-with-fenlmagic"></a><a class="link" href="#optional-parameters-with-fenlmagic">Optional Parameters (with fenlmagic)</a></h3>
<div class="paragraph">
<p>When querying using fenlmagic, the following optional parameters are
available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>--result-behavior</strong>: Determines which results are returned. Either
<code>all-results</code> <em>(default)</em>, or <code>final-results</code> which returns only the
final values for each entity.</p>
</li>
<li>
<p><strong>--output</strong>: Output format for the query results. One of <code>df</code> dataframe
<em>(default)</em>, <code>json</code>, <code>parquet</code> or <code>redis-bulk</code>.</p>
<div class="ulist">
<ul>
<li>
<p>If <code>redis-bulk</code>, --result-behavior is assumed to be <code>final-results</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>--data-token</strong>: Enables repeatable queries. Queries performed against
the same data token always run on the same input data.</p>
</li>
<li>
<p><strong>--preview-rows</strong>: Produces a preview of the data with at least this
many rows.</p>
</li>
<li>
<p><strong>--var</strong>: Assigns the body to a local variable with the given name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example use of some of these options can be found in the next section:
<a href="#reference:example-queries">Example Queries</a></p>
</div>
</div>
<div class="sect2">
<h3 id="tables-and-views"><a class="anchor" href="#tables-and-views"></a><a class="link" href="#tables-and-views">Tables and Views</a></h3>
<div class="paragraph">
<p>Most basic queries operate against tables. However, queries can also
operate on views or a combination of tables and views.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of using a view to filter the values produced by an
expression using a table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">%%fenl
{
  time: Purchase.purchase_time,
  entity: Purchase.customer_id,
  total_purchases: Purchase.amount | sum(),
} | when(PurchaseStats.max_amount &gt; 100)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Views may reference other views, so we could give this expression a name
and create a view for it as well if we wanted to.</p>
</div>
<div class="paragraph">
<p>Views are useful any time you need to share or re-use expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cleaning operations</p>
</li>
<li>
<p>Common business logic</p>
</li>
<li>
<p>Final feature vectors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more help with tables and views, see <a href="#reference:tables">Working with Tables</a>
and <a href="#reference:views">Working with Views</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-data-token"><a class="anchor" href="#using-data-token"></a><a class="link" href="#using-data-token">Using <code>--data-token</code></a></h3>
<div class="paragraph">
<p><code>--data-token</code>: Enables repeatable queries. Queries performed against
the same data token always run on the same input data.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use the data token id returned after loading the first file, and
results only include rows from the first file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ipython hljs" data-lang="ipython">%%fenl --data-token bdc9e595-a8a0-448c-9a95-c2e3d886b633
purchases</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">data_token_id: "bdc9e595-a8a0-448c-9a95-c2e3d886b633"
request_details {
  request_id: "3f737ff336666515a54dd29a9c5ace3a"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">purchase_time</th>
<th class="tableblock halign-left valign-top">customer_id</th>
<th class="tableblock halign-left valign-top">vendor_id</th>
<th class="tableblock halign-right valign-top">amount</th>
<th class="tableblock halign-right valign-top">subsort_id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-01 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-01 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-02 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-02 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-03 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-03 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-04 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-04 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-05 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-05 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>use the data token id returned after loading the second file, and
results rows from both files</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ipython hljs" data-lang="ipython">%%fenl --data-token 24c83cac-8cf4-4a45-98f0-dac8d5b303a2
purchases</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">data_token_id: "24c83cac-8cf4-4a45-98f0-dac8d5b303a2"
request_details {
  request_id: "3f737ff336666515a54dd29a9c5ace3a"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">purchase_time</th>
<th class="tableblock halign-left valign-top">customer_id</th>
<th class="tableblock halign-left valign-top">vendor_id</th>
<th class="tableblock halign-right valign-top">amount</th>
<th class="tableblock halign-right valign-top">subsort_id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-01 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-01 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-02 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-02 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-03 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-03 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-04 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-04 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-05 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-05 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-06 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wh_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-06 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spongebob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">weenie_hut</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-07 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spongebob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">34</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wh_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-08 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">weenie_hut</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-08 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="using-result-behavior"><a class="anchor" href="#using-result-behavior"></a><a class="link" href="#using-result-behavior">Using <code>--result-behavior</code></a></h3>
<div class="paragraph">
<p><code>--result-behavior</code>: Determines which results are returned.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use <code>all-results</code> (default) to return all the results for each entity:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ipython hljs" data-lang="ipython">%%fenl --result-behavior all-results
purchases</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">data_token_id: "7bd4e740-9e63-418e-ba9b-5582db010959"
request_details {
  request_id: "1badb8b0e220e26cc15b93b234ac3c14"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">purchase_time</th>
<th class="tableblock halign-left valign-top">customer_id</th>
<th class="tableblock halign-left valign-top">vendor_id</th>
<th class="tableblock halign-right valign-top">amount</th>
<th class="tableblock halign-right valign-top">subsort_id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-01 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-01 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-02 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-02 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-03 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-03 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-04 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-04 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-05 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_004</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-05 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-06 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wh_001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-06 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spongebob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">weenie_hut</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-07 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spongebob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">34</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wh_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-08 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">weenie_hut</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-08 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>use <code>final-results</code> to return only the most recent event for
each entity</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ipython hljs" data-lang="ipython">%%fenl --result-behavior final-results
purchases</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">data_token_id: "7bd4e740-9e63-418e-ba9b-5582db010959"
request_details {
  request_id: "145bc51d9bac47f17fd202e5785e58b7"
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">purchase_time</th>
<th class="tableblock halign-left valign-top">customer_id</th>
<th class="tableblock halign-left valign-top">vendor_id</th>
<th class="tableblock halign-right valign-top">amount</th>
<th class="tableblock halign-right valign-top">subsort_id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kk_006</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-08 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">patrick</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">krusty_krab</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wh_002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-08 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">karen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">weenie_hut</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cb_007</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-07 00:00:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spongebob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chum_bucket</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">34</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="using-preview-rows"><a class="anchor" href="#using-preview-rows"></a><a class="link" href="#using-preview-rows">Using <code>--preview-rows</code></a></h3>
<div class="paragraph">
<p><code>--preview-rows</code>: Produces a preview of the data with approximately this many rows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting a limit allows you to quickly iterate on features and verify
your results before running them over your full dataset</p>
</li>
<li>
<p>set to <code>50</code> on the <code>transactions</code> table to return a preview of at
least 50 rows</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ipython hljs" data-lang="ipython">%%fenl --preview-rows 50
transactions</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns a dataframe of 71599 rows, instead of the full dataset of 100000
rows.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It may seem odd that many thousands of rows were returned when
only 50 were requested. This happens because query operates on batches
and will return the results of all batches processed in order to reach
the minimum set of rows requested. In this case, compute processed only
a single batch, but the batch had a size of 71599 rows. Note: Using
<code>--preview-rows</code> with <code>--result-behavior final-results</code> will cause the
full dataset to be processed, as all inputs must be processed to produce
final results.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="querying-with-the-cli"><a class="anchor" href="#querying-with-the-cli"></a><a class="link" href="#querying-with-the-cli">Querying with the CLI</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The CLI can be used to make queries with the <code>kaskada-cli query run</code> command.
To query Kaskada using the CLI, the query string should be provided on <code>STDIN</code>.</p>
</div>
<div class="paragraph">
<p>An easy way to define a query is to create a text file containing the query.</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. query.fenl</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-Fenl hljs" data-lang="Fenl">{
  time: Purchase.purchase_time,
  entity: Purchase.customer_id,
  max_amount: last(Purchase.amount) | max(),
  min_amount: Purchase.amount | min()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the query by piping it to the CLI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat query.fenl | kaskada-cli query run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this query will return a JSON-formatted <a href="https://buf.build/kaskada/kaskada/docs/main:kaskada.kaskada.v1alpha#kaskada.kaskada.v1alpha.CreateQueryResponse">query response</a> object.
By default, query results are written to a Parquet file: the locations of these files are included along with additional query metadata in the query response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
	"state": "STATE_SUCCESS",
	"config": {
		"dataTokenId": "b5bc4597-47d4-4770-a772-0b94e0d12483"
	},
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting files are stored in the JSON path <code>outputTo.objectStore.outputPaths.paths</code> as an array of paths.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To slice and/or filter JSON output we can use <a href="https://stedolan.github.io/jq/">jq</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat query.fenl | kaskada-cli query run | jq '.outputTo.objectStore.outputPaths.paths'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return a list of result files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  "file:///&lt;pwd&gt;/data/results/3024b7ae-1429-4c12-867b-3a1f7e86099f/LfiWn-mIVspEbBE-G7yLYug3V2-dW4ASAGmV6g/6089a024-5d97-4f2c-9472-625791550505.parquet"
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For queries returning a small number of rows, it may be more convenient to output them to STDOUT formatted as CSV.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat query.fenl | kaskada-cli query run --stdout --response-as csv</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the full list of query arguments for the CLI with <code>kaskada-cli query run --help</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Executes a query on kaskada

Usage:
  cli query run "query-text" [flags]

Flags:
      --changed-since-time int       (Optional) Unix timestamp bound (inclusive) after which results will be output. If 'response-behavior' is 'all-results', this will include rows for changes (events and ticks) after this time (inclusive). If it is 'final-results', this will include a final result for any entity that would be included in the changed results.
      --data-token string            (Optional) A token to run queries against. Enables repeatable queries.
      --dry-run true                 (Optional) If this is true, then the query is validated and if there are no errors, the resultant schema is returned. No actual computation of results is performed.
      --experimental-features true   (Optional) If this is true, then experimental features are allowed.  Data returned when using this flag is not guaranteed to be correct.
  -h, --help                         help for run
      --preview-rows int             (Optional) Produces a preview of the results with at least this many rows.
      --response-as string           (Optional) How to encode the results.  Either 'parquet' or 'csv'. (default "parquet")
      --result-behavior string       (Optional) Determines how results are returned.  Either 'all-results' or 'final-results'. (default "all-results")
      --stdout true                  (Optional) If this is true, output results are sent to STDOUT

Global Flags:
      --config string               config file (default is $HOME/.cli.yaml)
  -d, --debug                       get debug log output
      --kaskada-api-server string   Kaskada API Server
      --kaskada-client-id string    Kaskada Client ID
      --use-tls                     Use TLS when connecting to the Kaskada API (default true)</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="tables.html">Tables</a></span>
  <span class="next"><a href="slices.html">Slices</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  © 2023 Kaskada Project Authors | Kaskada is an open source project and all
  source code is distributed under the Apache v2.0 license
</footer>

<!-- could not get this to work in the footer-scripts.hbs partial -->
<script async src="../../../_/js/vendor/tabs.js"></script><script src="../../../_/js/site.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script src="../../../_/js/vendor/fenl.min.js"></script>
<script>hljs.highlightAll();</script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="250" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
